<p><code class="highlighter-rouge">curl/1</code> — Access to the internet via the curl package with URL, Options, Target in one list.</p>

<p><code class="highlighter-rouge">curl/2</code> — Access to the internet via the curl package with separate URL arg, combined Options, Target in one list.</p>

<p><code class="highlighter-rouge">curl/3</code> — Access to the internet via the curl package with separate URL, Options, Target args.</p>

<p><code class="highlighter-rouge">http/3</code> — REST-inspired user-level interface for curl.</p>

<h2 id="forms">FORMS</h2>

<p><code class="highlighter-rouge">curl(Options)</code></p>

<p><code class="highlighter-rouge">curl(URL, Target)</code></p>

<p><code class="highlighter-rouge">curl(URL, Options, Target)</code></p>

<p><code class="highlighter-rouge">http(RESTVerb, URL, Options)</code></p>

<h2 id="description">DESCRIPTION</h2>

<p><a href="https://curl.haxx.se/">curl</a> is an open source software command line tool and library (<a href="https://curl.haxx.se/libcurl/">libcurl</a>) “for transferring data with URLs”.  The ALS Prolog interface to curl is built using the so-called “Easy interface” of the curl library.  In this approach, everything about any of the calls curl/[1,2,3] or http/3 is converted into a single list of Easy-oriented curl option equations, and that list is then passed to a C program built over the curl Easy interface API.  The predicates <code class="highlighter-rouge">curl/[1,2,3]</code> provide three variations on the theme of a rather direct interface to curl, while http/3 provides slightly higher-level REST-inspired transfer services.</p>

<p>For all equations on the <code class="highlighter-rouge">Options</code> list passed to the C program, the left side of every equation, which must be an atom,  is first converted to uppercase. Then, with the exception of the special equation tags</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'DATA', 'DATAFILE', 'EOL', 'EOLCODE', 'FIELDS', 'FIELDSFILE', 'RESULT', 'RESULTFILE', 'URL', 'POST',
</code></pre></div></div>
<p>(see below), the left side L of every equation L=R passed to the C plumbing over curl is prefixed with either <code class="highlighter-rouge">‘CURLOPT_’</code> or <code class="highlighter-rouge">‘CURLINFO_’</code>. The result of this prefixing must be either an <a href="https://curl.haxx.se/libcurl/c/curl_easy_setopt.html">easy option</a>  or an <a href="https://curl.haxx.se/libcurl/c/curl_easy_getinfo.html">info option</a>.</p>

<p>Several simple transformations are applied to the elements of the list:</p>

<p>i) Unary prolog expressions <code class="highlighter-rouge">&lt;F&gt;(A)</code> are allowed on the <code class="highlighter-rouge">Options</code> list. These are converted to equations <code class="highlighter-rouge">FF = A</code>, where <code class="highlighter-rouge">FF</code> is the uppercase version of <code class="highlighter-rouge">&lt;F&gt;</code>.</p>

<p>ii) Equations <code class="highlighter-rouge">E = A</code> are converted to <code class="highlighter-rouge">EE = A</code> where <code class="highlighter-rouge">EE</code> is the uppercase version of <code class="highlighter-rouge">E</code>.</p>

<p><code class="highlighter-rouge">Options</code> must be list of terms of the form <code class="highlighter-rouge">Tag = Value</code>.  <code class="highlighter-rouge">Tag</code> must be an atom, and when converted to all upper case, must either be one of the following</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'DATA', 'DATAFILE', 'EOL', 'EOLCODE', 'FIELDS', 'FIELDSFILE', 'RESULT', 'RESULTFILE', 'URL', 'POST',
</code></pre></div></div>
<p>or must be a <a href="https://curl.haxx.se/libcurl/c/curl_easy_setopt.html"><code class="highlighter-rouge">CURLOPT</code> expression</a>, or must be a <a href="https://curl.haxx.se/libcurl/c/curl_easy_getinfo.html"><code class="highlighter-rouge">CURLINFO</code> expression</a>.  Those prefixed with <code class="highlighter-rouge">CURLOPT</code> request specific services or pass information into curl.  Those prefixed with <code class="highlighter-rouge">CURLINFO</code> request various information to be returned from curl.</p>

<p>The acceptable expressions for <code class="highlighter-rouge">Value</code> will depend on <code class="highlighter-rouge">Tag</code> (see below).</p>

<p>Among curl/[1,2,3], curl/1 is basic:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl/1:
curl(Options)
Cleans up option capitalization and invokes the low-level interface to curl.
</code></pre></div></div>
<p>The other two are defined in terms of cur/1:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl/2:
Effectively:
curl(URL, Target)
    :-
    curl(URL, [], Target).

curl/3:
Effectively:
curl(URL, Options, Target)
    :-
    XOptions = [url=URL, result=Target | Options],
    curl(XOptions).
</code></pre></div></div>

<p>In <code class="highlighter-rouge">curl/1</code>, the one <code class="highlighter-rouge">Tag</code> which absolutely must be set is <code class="highlighter-rouge">'URL'=&lt;URL&gt;</code> (effectively <code class="highlighter-rouge">'CURLOPT_URL'=&lt;URL&gt;</code>), since this specifies where the file transfer will take place (to or from).  <code class="highlighter-rouge">&lt;URL&gt;</code> must be an atom (typically a UIA) which describes a proper url.</p>

<p><strong>Common options:</strong></p>

<ul>
  <li>The special equation
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>‘RESULT’ = Expr [or, result = Expr]
</code></pre></div>    </div>
    <p>can appear on <code class="highlighter-rouge">Options</code>. Whatever transfer result is produced from the underlying curl call is turned into a UIA and is unified with <code class="highlighter-rouge">Expr</code>, which can be any prolog expression, including an unbound variable.</p>
  </li>
  <li>The special equation
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>'RESULTFILE' = '&lt;local file path&gt;' [or resultfile = '&lt;local file path&gt;']
</code></pre></div>    </div>
    <p>can also appear on <code class="highlighter-rouge">Options</code>. Whatever transfer result is produced from the underlying curl call is written into the file at <code class="highlighter-rouge">&lt;local file path&gt;</code>.  Note that both <code class="highlighter-rouge">result = Expr</code> and <code class="highlighter-rouge">resultfile = '&lt;local file path&gt;'</code> can occur together on an <code class="highlighter-rouge">Options</code> list: the transfer result will be unified (as a UIA) with <code class="highlighter-rouge">Expr</code> and also written into the file at <code class="highlighter-rouge">&lt;local file path&gt;</code>.</p>
  </li>
</ul>

<p>Further <code class="highlighter-rouge">CURLOPT_</code> options are described below in connection with http/3.</p>

<p>Appropriate <code class="highlighter-rouge">CURLINFO</code> options can be used with any of curl/[1,2,3] or http/3.. For example, including <code class="highlighter-rouge">response_code(RC)</code> on <code class="highlighter-rouge">Options</code> will bind <code class="highlighter-rouge">RC</code> to the HTTP response code returned by the server (e.g., 200, 404, etc.), and including <code class="highlighter-rouge">total_time(TTT)</code> will bind <code class="highlighter-rouge">TTT</code> to the number of seconds expended in the transaction.</p>

<p>For transferring information outbound, data for POSTing can be supplied in one of two forms: 1) structured data such as is uploaded from Web forms (e.g., ‘name=admin&amp;shoesize=12’) and 2) free-form text data (e.g., ‘lorem ipsum doler’). Either type of data can be supplied either directly in an equation on the <code class="highlighter-rouge">Options</code> list, or in a file specified on the <code class="highlighter-rouge">Options</code> list:</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">data = &lt;atom&gt; (’DATA’=&lt;atom&gt;)</code> (where <code class="highlighter-rouge">&lt;atom&gt;</code> is a symbol or UIA) occurs on the <code class="highlighter-rouge">Options</code> list, then the underlying curl program will POST the text of <code class="highlighter-rouge">&lt;atom&gt;</code> via the curl equation <code class="highlighter-rouge">'READDATA'=&lt;atom&gt;</code>.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">datefile=&lt;FilePathName&gt;(‘DATAFILE’=&lt;FilePathName&gt;)</code> occurs on the <code class="highlighter-rouge">Options</code> list, then the complete text occurring in <code class="highlighter-rouge">&lt;FilePathName&gt;</code> is read into a single UIA <code class="highlighter-rouge">DT</code>, and the information is POSTED as if <code class="highlighter-rouge">‘DATA’=DT</code> had been included on <code class="highlighter-rouge">Options</code>. The basic method of reading the file is to read it line by line, concatenating the lines to make the single UIA <code class="highlighter-rouge">DT</code>. For convenience, two special options are provided which allow one to specify a character to be used in concatenating the file lines. If the equation <code class="highlighter-rouge">eol = &lt;char&gt;</code> (or, <code class="highlighter-rouge">'EOL'=&lt;char&gt;</code>) is present on the options list, when <code class="highlighter-rouge">&lt;FilePathName&gt;</code> is read, the character <code class="highlighter-rouge">&lt;char&gt;</code> will be used as a separator between the concatenated lines. Equivalently, if <code class="highlighter-rouge">eolcode=&lt;charcode&gt;</code> (or, <code class="highlighter-rouge">'EOLCODE'=&lt;charcode&gt;</code>) is present on the list, the character with code <code class="highlighter-rouge">&lt;charcode&gt;</code> will be used as the separator. (So, for example, spaces or newlines could be supplied as the separators.)</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">fields = &lt;atom&gt;</code> (or, <code class="highlighter-rouge">‘FIELDS’=&lt;atom&gt;</code>) occurs on <code class="highlighter-rouge">Options</code>, then <code class="highlighter-rouge">&lt;atom&gt;</code> should represent a structured fields expression (e.g., <code class="highlighter-rouge">'name=admin&amp;shoesize=12’</code>). The underlying curl program will POST the text of <code class="highlighter-rouge">&lt;atom&gt;</code> via <code class="highlighter-rouge">'POSTFIELDS'=&lt;atom&gt;</code>.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">fieldsfile = &lt;FilePathName&gt;</code> (or, <code class="highlighter-rouge">‘FIELDSFILE’= &lt;FilePathName&gt;</code>) occurs on <code class="highlighter-rouge">Options</code>, then the complete text occurring in <code class="highlighter-rouge">&lt;FilePathName&gt;</code> is read into a UIA <code class="highlighter-rouge">FE</code>, just as for <code class="highlighter-rouge">'DATAFILE'</code>, and the information is POSTED as if <code class="highlighter-rouge">‘FIELDS’=FE</code> had been included on <code class="highlighter-rouge">Options</code>. As with <code class="highlighter-rouge">'DATAFILE'</code>, the basic method of reading the file concatenates all the lines into a single UIA, but this can be modified by use of the <code class="highlighter-rouge">eol = &lt;char&gt; ('EOL'=&lt;char&gt;)</code> or <code class="highlighter-rouge">eolcode=&lt;charcode&gt; ('EOLCODE'=&lt;charcode&gt;)</code> special equations. (So, for example, amperstands (<code class="highlighter-rouge">&amp;</code>) could be supplied as the separator.)</p>
  </li>
</ul>

<p>Inspired by the REST approach to internet file transfer,</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http/3
http(RESTVerb, URL, Options)
</code></pre></div></div>
<p>provides REST-inspired transfer services. At present, the following RESTVerbs are implemented:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>get, post put, delete, head, options, patch.
</code></pre></div></div>
<p>The available <code class="highlighter-rouge">Options</code> overall are the same as for <code class="highlighter-rouge">curl/[1,2,3]</code>, but in individual calls, depend on the RESTVerb. The special equations and special equation tags are the also the same as for <code class="highlighter-rouge">curl/[1,2,3]</code>.</p>

<h2 id="examples">EXAMPLES</h2>

<p>These three calls provide the same service and response, except that curl/2 cannot provide the <code class="highlighter-rouge">response_code</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?- curl('http://example.com', [response_code(RC)], RR).
?- curl('http://example.com', RR).
?- curl([url='http://example.com', response_code=RC, result=RR]).
RC=200 
RR='<span class="cp">&lt;!doctype html&gt;</span>\n<span class="nt">&lt;html&gt;</span>\n<span class="nt">&lt;head&gt;</span>\n    <span class="nt">&lt;title&gt;</span>Example Domain<span class="nt">&lt;/title&gt;</span>......<span class="nt">&lt;/html&gt;</span>\n' 

yes.

http(get, 'http://example.com', [response_code(RC), result=RR]).

RC=200 
RR='<span class="cp">&lt;!doctype html&gt;</span>\n<span class="nt">&lt;html&gt;</span>\n<span class="nt">&lt;head&gt;</span>\n    <span class="nt">&lt;title&gt;</span>Example Domain<span class="nt">&lt;/title&gt;</span>......<span class="nt">&lt;/html&gt;</span>\n'

yes.

?- http(post, 'https://postman-echo.com/post', [fields='name=admin<span class="err">&amp;</span>shoesize=12', result=RR]).

RR='{"args":{},"data":"","files":{},"form":{"name":"admin","shoesize":"12"},"headers":{"x-forwarded-proto":"https","host":"postman-echo.com","content-length":"22","accept":"*/*","content-type":"application/x-www-form-urlencoded","x-forwarded-port":"443"},"json":{"name":"admin","shoesize":"12"},"url":"https://postman-echo.com/post"}' 

yes.
</code></pre></div></div>
<h2 id="errors">ERRORS</h2>
<p><code class="highlighter-rouge">curl(Options)</code>
<code class="highlighter-rouge">curl(URL, Target)</code>
<code class="highlighter-rouge">curl(URL, Options, Target)</code>
<code class="highlighter-rouge">http(RESTVerb, URL, Options)</code></p>

<p><code class="highlighter-rouge">Options</code> is a variable</p>

<p>– – – – &gt; <code class="highlighter-rouge">instantiation_error</code></p>

<p><code class="highlighter-rouge">Options</code> is neither a variable nor a list</p>

<p>– – – – &gt; <code class="highlighter-rouge">type_error(list, Option)</code></p>

<p><code class="highlighter-rouge">Options</code> is a list an element of which is a variable</p>

<p>– – – – &gt; <code class="highlighter-rouge">instantiation_error</code></p>

<p><code class="highlighter-rouge">Options</code> is a list containing an element <code class="highlighter-rouge">E</code> which is neither a curl equation nor a unary prolog expression</p>

<p>– – – – &gt; <code class="highlighter-rouge">domain_error(type_error('equation (_=_)', E)</code></p>

<p><code class="highlighter-rouge">URL</code> is a variable</p>

<p>– – – – &gt; <code class="highlighter-rouge">instantiation_error</code></p>

<p><code class="highlighter-rouge">URL</code> is not an atom</p>

<p>– – – – &gt; <code class="highlighter-rouge">domain_error(atom,URL)</code></p>

<p><code class="highlighter-rouge">URL</code> does not indicate an internet host</p>

<p>– – – – &gt; <code class="highlighter-rouge">curl_error: 'curl_easy_perform() failed: Couldn\'t resolve host name\n'</code></p>

<p><code class="highlighter-rouge">Target</code> is a variable</p>

<p>– – – – &gt; <code class="highlighter-rouge">instantiation_error</code></p>

<p><code class="highlighter-rouge">RESTVerb</code> is not one of the listed REST verbs</p>

<p>– – – – &gt; <code class="highlighter-rouge">domain_error(http_rest_verb,RESTVerb)</code></p>

<h2 id="notes">NOTES</h2>

<p>Access to curl is also provided by ALS Prolog streams.  See the discussion under  <em>URLs: Internet Streams</em> in <strong><em>Section 10.2.2 SourceSink Terms</em></strong>, in the <strong>User Guide (Prolog I/O)</strong>.</p>

<h2 id="see-also">SEE ALSO</h2>

<ul>
  <li><a href="https://curl.haxx.se/">curl</a></li>
  <li><a href="https://curl.haxx.se/libcurl/">libcurl - the multiprotocol file transfer library</a></li>
  <li><a href="https://curl.haxx.se/libcurl/c/curl_easy_setopt.html">curl_easy_setopt - set options for a curl easy handle</a></li>
  <li><a href="https://curl.haxx.se/libcurl/c/curl_easy_getinfo.html">curl_easy_getinfo - extract information from a curl handle</a></li>
</ul>
