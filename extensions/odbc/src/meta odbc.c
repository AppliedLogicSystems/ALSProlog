/* meta-odbc interface *//*example: sql_init.sql_open_connection(C, 'sdk21-Access32', '', ''),sql_open_statement(C, 'select * from customer', S),sql_execute_statement(S),sql_fetch_row(S, R),sql_close_statement(S),sql_close_connection(C).sql_shutdown.R = ['bob', '203 Main St.', ...]*//*init - sets a global for the enironment - books says it is global for each app.*/:- make_gv('_odbc_environment').sql_init :-	sql_alloc_env(Environment),	set_odbc_environment(Environment).sql_shutdown :-	get_odbc_environment(Environment),	sql_free_env(Environment)./* sql_alloc_connect/2 is already defined */sql_open_connection(DataSource, User, Password, Connection) :-	get_odbc_environment(Environment),	sql_alloc_connect(Environment, Connection),	catch ((		sql_connect(Connection, DataSource, User, Password)	), ConnectError, (		sql_free_connect(Connection),		throw(ConnectError)	)).sql_close_connection(Connection) :-	catch ((		sql_disconnect(Connection)	), DisconnectError, (		sql_free_connect(DBConnection),		throw(DisconnectError)	)),	sql_free_connect(Connection).sql_open_statement(Connection, SQLQuery, StatementTerm) :-	sql_alloc_stmt(Connection, StatementHandle),	catch ((		sql_prepare(StatementHandle, SQLQuery),		sql_num_result_cols(StatementHandle, NumColumns),		alloc_col_info(StatementHandle, 1, NumColumns, ColumnInfoList),		StatementTerm = statement(StatementHandle, ColumnInfoList)	), StatementError, (		sql_free_stmt(StatementHandle, 'SQL_DROP'),		throw(StatementError)	)).alloc_col_info(Statement, MaxCols, MaxCols, []).alloc_col_info(Statement, N, MaxCols, [col_info(Datum, Len) | RestData]) :-	c_allocn_abs(char, 255, Datum),	c_alloc_abs(int, Len),	sql_bind_col(Statement, N, 'SQL_C_CHAR', Datum, 255, Len),	NextN is N + 1,	alloc_col_info(Statement, NextN, MaxCols, RestData, RestLen).sql_close_statement(statement(StatementHandle, ColumnInfoList)) :-		catch ((			sql_free_stmt(StatementHandle, 'SQL_DROP')		), FreeError, (			free_col_info(ColumnInfoList),			throw(FreeError)		)),		free_col_info(ColumnInfoList).free_col_info([]).free_col_info([col_info(Datum, Len) | Rest]) :-	c_free(Datum), c_free(Len),	free_col_info(Rest).	sql_execute_statement(statement(StatementHandle, _, _)) :-	sql_execute(StatementHandle).sql_bind_row(statement(StatementHandle, ColumnInfoList), Row) :-	.	sql_fetch_row(statement(StatementHandle, ColumnInfoList), Row) :-	sql_fetch(StatementHandle),	collect_results(ColumnInfoList, Row).collect_results([], []).collect_results([col_info(Datum, Len) | ColRest], [Result | ResultRest]) :-	c_examine(Datum, str, Result),	collect_results(ColRest, ResultRest).